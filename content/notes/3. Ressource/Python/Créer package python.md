Create_Date : 02/12/2022
MOC : [[Package]]
Tags : #Python #Package #Pypi 

----------------------------------

## Arborescence du package

Un dossier avec le nom du package
	Contenant un fichier \_\_init\_\_.py et les fichier de code
Un fichier readme.md pour la doc affiché sur pypi
Un fichier setup.py

![Arbo](data:image/png;base64,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)

<br>

## Le fichier \_\_init\_\_.py

Le fichier \_\_init\_\_.py sera le fichier lancé lors de l'import du module dans notre code.
Nous pouvons éxecuter le code directement dedans ou importer son fichier de code.

```python
__version__ = '1.2'
__author__ = 'Auteur de mon package'
__descriptor__ = 'Description de mon package'
__lastupdate__ = '02/12/2022'
__releasenote__ = 'Info du dernier update'

from .MonPackage import *
```

<br>

## Le fichier setup.py

Le fichier setup va permettre d'avoir les paramètres pour créer le package build.
Pour des raisons pratiques, nous récupérons les informations depuis le fichier \_\_init\_\_ du package


```python
from setuptools import setup
import MonPackage

setup(
    name='NomDuPackages',
    packages=['Package'],
    description=MonPackage.__descriptor__,
    version=MonPackage.__version__,
    url='URLVersUneDoc',
    author=MonPackage.__author__,
    author_email='MailDeLAuteur',
    keywords=['pip', 'pypi']  #MotClé pour retrouvé le package sur pypi facilement
    classifiers = ["Development Status :: 5 - Production/Stable"]  
)
```

>Liste de classifiers disponibles: https://pypi.org/classifiers/

<br>

## Le fichier \_\_main\_\_.py

Le fichier \_\_main\_\_ permet de déterminer du code qui pourait être exécuter depuis l'invite de commande avec:
```console
python -m MonPackage
```

Pour un code propre, ajouter la ligne suivante dans le fichier 

```python
if __name__ == "__main__":
```


<br>
## Build du package

Pour build les fichiers de package, il suffit de lancer cette commande depuis le dossier contenant le setup.py

```console
python setup.py sdist bdist_wheel
```

> *sdist*: package .tar.gz
> *bdist_wheel*: package wheel


<br>
## Upload du package

###### <span style="color:#6b6b6b;font-weight: bold;">Installation du module d'upload</span>

```console
pip install twine
```


###### <span style="color:#6b6b6b;font-weight: bold;">Configuration du fichier de paramètre twine</span>

Le fichier ~/.pypirc permet de configurer les différents repo accessible

 _~/.pypirc_
 ```ini
[distutils]
index-servers =
    pypi
    pylocal

[pypi]
repository = https://upload.pypi.org/legacy/
username = MonUser

[pylocal]
repository = https://pypi.apajak.fr:2222/
username = MonUser
password = MonPassWord
```

La section distutils avec le paramètre index-servers regroupe le nom des repo configurés
Chaque section représente un repo et à des paramètres suivants:
- repository: ip ou non d'host du repo
- username: le username qui sera utilisé pour s'authentifier sur le serveur
- password: password pour s'authentifier sur le serveur (pas conseillé de l'utiliser)


###### <span style="color:#6b6b6b;font-weight: bold;">Envoi du package</span>

```console
twine upload --repository aws dist/*
```

```console
twine upload --repository-url http://<PUBLIC-IP-ADDRESS>:8080 dist/*
```
